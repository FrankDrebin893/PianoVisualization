<Window x:Class="PianoMidiVisualizationApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:views="clr-namespace:PianoMidiVisualizationApp.Views"
        Title="Piano MIDI Visualization"
        Width="1400" Height="500"
        WindowStartupLocation="CenterScreen"
        Background="#1E1E1E"
        KeyDown="Window_KeyDown">
    <DockPanel>
        <!-- Settings panel at top -->
        <views:SettingsPanel DockPanel.Dock="Top" DataContext="{Binding}"/>

        <!-- Status bar at bottom -->
        <Border DockPanel.Dock="Bottom" Background="#252525" Padding="10,4">
            <TextBlock Text="{Binding StatusText}" Foreground="#AAAAAA" FontSize="12"/>
        </Border>

        <!-- MIDI log panel at bottom -->
        <Border DockPanel.Dock="Bottom" Background="#1A1A1A" Height="120" Padding="4">
            <DockPanel>
                <TextBlock DockPanel.Dock="Top" Text="MIDI Log" Foreground="#888888" FontSize="11" Margin="4,0,0,2"/>
                <ListBox ItemsSource="{Binding MidiLog}"
                         Background="#111111" Foreground="#00DD00" FontFamily="Consolas" FontSize="11"
                         BorderThickness="0"
                         x:Name="MidiLogList"
                         ScrollViewer.HorizontalScrollBarVisibility="Auto">
                    <ListBox.ItemContainerStyle>
                        <Style TargetType="ListBoxItem">
                            <Setter Property="Padding" Value="2,0"/>
                            <Setter Property="Foreground" Value="#00DD00"/>
                        </Style>
                    </ListBox.ItemContainerStyle>
                </ListBox>
            </DockPanel>
        </Border>

        <!-- Chord display -->
        <Border DockPanel.Dock="Bottom" Background="#252525" Padding="12,8">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                <TextBlock Text="{Binding CurrentChord}"
                           Foreground="White" FontSize="24" FontWeight="Bold"
                           VerticalAlignment="Center"/>
                <TextBlock Text="  (Space to save)" Foreground="#666666" FontSize="12"
                           VerticalAlignment="Center"
                           Visibility="{Binding CurrentChord, Converter={StaticResource StringToVisibilityConverter}}"/>
            </StackPanel>
        </Border>

        <!-- Saved chords panel on right -->
        <Border DockPanel.Dock="Right" Background="#252525" Width="180" Padding="8">
            <DockPanel>
                <TextBlock DockPanel.Dock="Top" Text="Chord Progression"
                           Foreground="#AAAAAA" FontSize="12" FontWeight="SemiBold"
                           Margin="0,0,0,8"/>
                <TextBlock DockPanel.Dock="Bottom" Text="{Binding SavedChords.Count, StringFormat='{}{0}/8 chords'}"
                           Foreground="#666666" FontSize="10" Margin="0,8,0,0"/>
                <ItemsControl ItemsSource="{Binding SavedChords}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate>
                            <Border Background="#303030" CornerRadius="4" Margin="0,0,0,6" Padding="8,6">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="{Binding ChordName}"
                                                   Foreground="White" FontSize="16" FontWeight="Bold"/>
                                        <TextBlock Text="{Binding NotesDisplay}"
                                                   Foreground="#888888" FontSize="10" TextWrapping="Wrap"/>
                                    </StackPanel>
                                    <Button Grid.Column="1" Content="âœ•"
                                            Command="{Binding DataContext.RemoveChordCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                            CommandParameter="{Binding}"
                                            Background="Transparent" Foreground="#888888"
                                            BorderThickness="0" FontSize="14" Cursor="Hand"
                                            VerticalAlignment="Top" Padding="4,0"
                                            ToolTip="Remove chord">
                                        <Button.Style>
                                            <Style TargetType="Button">
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="Button">
                                                            <Border Background="{TemplateBinding Background}" Padding="{TemplateBinding Padding}">
                                                                <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                            </Border>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                                <Style.Triggers>
                                                    <Trigger Property="IsMouseOver" Value="True">
                                                        <Setter Property="Foreground" Value="#FF6666"/>
                                                    </Trigger>
                                                </Style.Triggers>
                                            </Style>
                                        </Button.Style>
                                    </Button>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </DockPanel>
        </Border>

        <!-- Piano keyboard fills remaining space -->
        <ScrollViewer HorizontalScrollBarVisibility="Auto"
                      VerticalScrollBarVisibility="Disabled"
                      Background="#333333"
                      Padding="0,20,0,0">
            <views:PianoKeyboardControl
                DataContext="{Binding PianoKeyboard}"
                HorizontalAlignment="Center"
                VerticalAlignment="Top"/>
        </ScrollViewer>
    </DockPanel>
</Window>
